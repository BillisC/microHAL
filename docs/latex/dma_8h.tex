\doxysection{src/drivers/dma.h File Reference}
\hypertarget{dma_8h}{}\label{dma_8h}\index{src/drivers/dma.h@{src/drivers/dma.h}}


Function prototypes for the DMA driver.  


{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include "{}stm32f4xx.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{dma_8h_a91b0179f3f180d382cb86891708725f6}{DMA}}(x)
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{dma_8h_acb4c9afece395581961a451cf89a0daf}\label{dma_8h_acb4c9afece395581961a451cf89a0daf} 
typedef enum dma\+\_\+dir {\bfseries dma\+\_\+dir\+\_\+t}
\item 
\Hypertarget{dma_8h_a1732e13bbb47e74a2237ea590425326a}\label{dma_8h_a1732e13bbb47e74a2237ea590425326a} 
typedef enum dma\+\_\+datasize {\bfseries dma\+\_\+datasize\+\_\+t}
\item 
\Hypertarget{dma_8h_a945cea4e4c15bf97a414f0a003067de6}\label{dma_8h_a945cea4e4c15bf97a414f0a003067de6} 
typedef enum dma\+\_\+priority {\bfseries dma\+\_\+priority\+\_\+t}
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{dma_8h_a196fc6dd22613931cb7033e8349cf666}\label{dma_8h_a196fc6dd22613931cb7033e8349cf666} 
enum {\bfseries dma\+\_\+dir} \{ {\bfseries DMA\+\_\+\+DIR\+\_\+\+PER2\+MEM} = 0x00
, {\bfseries DMA\+\_\+\+DIR\+\_\+\+MEM2\+PER} = 0x01
, {\bfseries DMA\+\_\+\+DIR\+\_\+\+MEM2\+MEM} = 0x02
 \}
\item 
\Hypertarget{dma_8h_a9124186f3969f38be8d5aeb68abee24a}\label{dma_8h_a9124186f3969f38be8d5aeb68abee24a} 
enum {\bfseries dma\+\_\+datasize} \{ {\bfseries DMA\+\_\+\+DATASIZE\+\_\+\+BYTE} = 0x00
, {\bfseries DMA\+\_\+\+DATASIZE\+\_\+\+HWRD} = 0x01
, {\bfseries DMA\+\_\+\+DATASIZE\+\_\+\+WORD} = 0x02
 \}
\item 
\Hypertarget{dma_8h_acff7214370827484610e276b30f6da75}\label{dma_8h_acff7214370827484610e276b30f6da75} 
enum {\bfseries dma\+\_\+priority} \{ {\bfseries DMA\+\_\+\+PRIORITY\+\_\+\+LOW} = 0x00
, {\bfseries DMA\+\_\+\+PRIORITY\+\_\+\+MED} = 0x01
, {\bfseries DMA\+\_\+\+PRIORITY\+\_\+\+HIG} = 0x02
, {\bfseries DMA\+\_\+\+PRIORITY\+\_\+\+VHI} = 0x03
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{dma_8h_aca54331a15cc778242368edbc58074d6}\label{dma_8h_aca54331a15cc778242368edbc58074d6} 
struct {\bfseries \+\_\+\+\_\+attribute\+\_\+\+\_\+} ((packed)) DMAStream\+Regs
\item 
void \mbox{\hyperlink{dma_8h_a85a6e9d9a27dec6506deb4df62739b63}{dma\+\_\+set\+\_\+addresses}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const uint32\+\_\+t PA, const uint32\+\_\+t M0A, const uint32\+\_\+t M1A)
\begin{DoxyCompactList}\small\item\em Set the DMA source and destination addresses. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_a15de574c8c2114715651fc14586853f1}{dma\+\_\+configure\+\_\+data}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const uint16\+\_\+t count, const dma\+\_\+datasize\+\_\+t msize, const dma\+\_\+datasize\+\_\+t psize)
\begin{DoxyCompactList}\small\item\em Set DMA transfers to specified configuration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_aee1bdf1a525c3c27fd3924ceb1bfc6f0}{dma\+\_\+set\+\_\+direction}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const dma\+\_\+dir\+\_\+t direction)
\begin{DoxyCompactList}\small\item\em Set DMA transfers to the desired direction. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_a729deea5992aa6db7a941f425b1f6b87}{dma\+\_\+configure\+\_\+stream}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const struct DMAStream\+Config config)
\begin{DoxyCompactList}\small\item\em Set DMA stream to the specified configuration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_ae71d23609ff4bd49f8b32a853ded4ee2}{dma\+\_\+set\+\_\+channel}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const uint8\+\_\+t channel, const dma\+\_\+priority\+\_\+t priority)
\begin{DoxyCompactList}\small\item\em Set the DMA stream channel and priority. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_a697c7ee8843ceabcb67aa490bb1c5747}{dma\+\_\+set\+\_\+interrupts}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream, const struct DMAStream\+ISR config)
\begin{DoxyCompactList}\small\item\em Enabled the specified DMA stream interrupts. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_a88e3967cf41b526d098bdfe069de0159}{dma\+\_\+enable}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream)
\begin{DoxyCompactList}\small\item\em Enables DMA stream transfers. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{dma_8h_aafaeaadc24e0bd880951898b65bf10db}{dma\+\_\+disable}} (const uint8\+\_\+t dma, const uint8\+\_\+t stream)
\begin{DoxyCompactList}\small\item\em Disables DMA stream transfers. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Function prototypes for the DMA driver. 

This file contains all of the enums, macros, and function prototypes required for a functional DMA driver.

DISCLAIMER\+: No burst or FIFO for the time being!

\begin{DoxyAuthor}{Author}
Vasileios Ch. (BillisC) 
\end{DoxyAuthor}
\begin{DoxyRefDesc}{Bug}
\item[\mbox{\hyperlink{bug__bug000004}{Bug}}]There is a case where DMA1 clears EN Sx\+CR bit when the peripheral address is USART2 DR. There is no workaround at the moment (is it errata?). \end{DoxyRefDesc}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{dma_8h_a91b0179f3f180d382cb86891708725f6}\index{dma.h@{dma.h}!DMA@{DMA}}
\index{DMA@{DMA}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{DMA}{DMA}}
{\footnotesize\ttfamily \label{dma_8h_a91b0179f3f180d382cb86891708725f6} 
\#define DMA(\begin{DoxyParamCaption}\item[{}]{x}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{(\textcolor{keyword}{struct\ }DMARegs\ *)(DMA1\_BASE\ +\ ((x\ -\/\ 1)\ *\ 0x400UL))}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\Hypertarget{dma_8h_a15de574c8c2114715651fc14586853f1}\index{dma.h@{dma.h}!dma\_configure\_data@{dma\_configure\_data}}
\index{dma\_configure\_data@{dma\_configure\_data}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_configure\_data()}{dma\_configure\_data()}}
{\footnotesize\ttfamily \label{dma_8h_a15de574c8c2114715651fc14586853f1} 
void dma\+\_\+configure\+\_\+data (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const uint16\+\_\+t}]{count}{, }\item[{const dma\+\_\+datasize\+\_\+t}]{msize}{, }\item[{const dma\+\_\+datasize\+\_\+t}]{psize}{}\end{DoxyParamCaption})}



Set DMA transfers to specified configuration. 

The DMA datasizes are specified in the dma\+\_\+datasize\+\_\+t enum. Any other value will be ignored.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em count} & The total number of data items \\
\hline
{\em msize} & The size of data stored in memory \\
\hline
{\em psize} & The size of data stored in the peripheral \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_a729deea5992aa6db7a941f425b1f6b87}\index{dma.h@{dma.h}!dma\_configure\_stream@{dma\_configure\_stream}}
\index{dma\_configure\_stream@{dma\_configure\_stream}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_configure\_stream()}{dma\_configure\_stream()}}
{\footnotesize\ttfamily \label{dma_8h_a729deea5992aa6db7a941f425b1f6b87} 
void dma\+\_\+configure\+\_\+stream (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const struct DMAStream\+Config}]{config}{}\end{DoxyParamCaption})}



Set DMA stream to the specified configuration. 

The DMA stream options are specified in the DMAStream\+Config struct.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em config} & The stream configuration \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_aafaeaadc24e0bd880951898b65bf10db}\index{dma.h@{dma.h}!dma\_disable@{dma\_disable}}
\index{dma\_disable@{dma\_disable}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_disable()}{dma\_disable()}}
{\footnotesize\ttfamily \label{dma_8h_aafaeaadc24e0bd880951898b65bf10db} 
void dma\+\_\+disable (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{}\end{DoxyParamCaption})}



Disables DMA stream transfers. 


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_a88e3967cf41b526d098bdfe069de0159}\index{dma.h@{dma.h}!dma\_enable@{dma\_enable}}
\index{dma\_enable@{dma\_enable}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_enable()}{dma\_enable()}}
{\footnotesize\ttfamily \label{dma_8h_a88e3967cf41b526d098bdfe069de0159} 
void dma\+\_\+enable (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{}\end{DoxyParamCaption})}



Enables DMA stream transfers. 


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_a85a6e9d9a27dec6506deb4df62739b63}\index{dma.h@{dma.h}!dma\_set\_addresses@{dma\_set\_addresses}}
\index{dma\_set\_addresses@{dma\_set\_addresses}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_set\_addresses()}{dma\_set\_addresses()}}
{\footnotesize\ttfamily \label{dma_8h_a85a6e9d9a27dec6506deb4df62739b63} 
void dma\+\_\+set\+\_\+addresses (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const uint32\+\_\+t}]{PA}{, }\item[{const uint32\+\_\+t}]{M0A}{, }\item[{const uint32\+\_\+t}]{M1A}{}\end{DoxyParamCaption})}



Set the DMA source and destination addresses. 

Usually only the peripheral and M0 addresses are needed. In that case you shall set M1A to zero.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em PA} & The peripheral address \\
\hline
{\em M0A} & The memory 0 address \\
\hline
{\em M1A} & The memory 1 address \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_ae71d23609ff4bd49f8b32a853ded4ee2}\index{dma.h@{dma.h}!dma\_set\_channel@{dma\_set\_channel}}
\index{dma\_set\_channel@{dma\_set\_channel}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_set\_channel()}{dma\_set\_channel()}}
{\footnotesize\ttfamily \label{dma_8h_ae71d23609ff4bd49f8b32a853ded4ee2} 
void dma\+\_\+set\+\_\+channel (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const uint8\+\_\+t}]{channel}{, }\item[{const dma\+\_\+priority\+\_\+t}]{priority}{}\end{DoxyParamCaption})}



Set the DMA stream channel and priority. 

The DMA priority levels are specified in the dma\+\_\+priority\+\_\+t enum. Any other value will be ignored. Refer to the chip\textquotesingle{}s manual for the channel function matrix.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em channel} & The selected channel (0..7) \\
\hline
{\em priority} & The stream priority level \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_aee1bdf1a525c3c27fd3924ceb1bfc6f0}\index{dma.h@{dma.h}!dma\_set\_direction@{dma\_set\_direction}}
\index{dma\_set\_direction@{dma\_set\_direction}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_set\_direction()}{dma\_set\_direction()}}
{\footnotesize\ttfamily \label{dma_8h_aee1bdf1a525c3c27fd3924ceb1bfc6f0} 
void dma\+\_\+set\+\_\+direction (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const dma\+\_\+dir\+\_\+t}]{direction}{}\end{DoxyParamCaption})}



Set DMA transfers to the desired direction. 

The DMA directions are specified in the dma\+\_\+dir\+\_\+t enum. Any other value will be ignored. After that set the addresses according to the chip\textquotesingle{}s manual.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em direction} & The transfer direction \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{dma_8h_a697c7ee8843ceabcb67aa490bb1c5747}\index{dma.h@{dma.h}!dma\_set\_interrupts@{dma\_set\_interrupts}}
\index{dma\_set\_interrupts@{dma\_set\_interrupts}!dma.h@{dma.h}}
\doxysubsubsection{\texorpdfstring{dma\_set\_interrupts()}{dma\_set\_interrupts()}}
{\footnotesize\ttfamily \label{dma_8h_a697c7ee8843ceabcb67aa490bb1c5747} 
void dma\+\_\+set\+\_\+interrupts (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t}]{dma}{, }\item[{const uint8\+\_\+t}]{stream}{, }\item[{const struct DMAStream\+ISR}]{config}{}\end{DoxyParamCaption})}



Enabled the specified DMA stream interrupts. 

The available DMA interrupts are located in the DMAStream\+ISR struct.


\begin{DoxyParams}{Parameters}
{\em dma} & The selected DMA (1..2) \\
\hline
{\em stream} & The selected stream (0..7) \\
\hline
{\em config} & The interrupt configuration \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
